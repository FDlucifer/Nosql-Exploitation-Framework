from __future__ import print_function
# H-Base Attack Platform
from starbase import Connection
from termcolor import colored


def hbase_enum(target, port):
    print(colored(
        "\n[!] Enumeration Module For NoSQL Framework H-Base Launched.....", 'yellow'))
    print(colored("[-] Enumerating Cluster Version and Cluster Status", 'blue'))
    try:
        c = Connection(target, port)
        print(colored("[-] Cluster Version: %s" %
                      (str(c.cluster_version)), 'green'))
        v = c.cluster_status
        print(colored("[-] Cluster Status ", 'green'))
        for key, value in v.iteritems():
            print(colored("\t [-] "+str(key)+":"+str(value), 'green'))
        print(colored("[-] Enumerating JVM and Box Details", 'blue'))
        for key, value in c.version.iteritems():
            print(colored("\t[-] "+str(key)+":"+str(value), 'green'))
        print(colored("[-] Tables Available", 'blue'))
        for i in c.tables():
            print(colored("\t[-] "+i, 'green'))
        print(colored("Would you like to enumerate columns", 'blue'))
        choice = raw_input()
        if choice == 'y':
            tab = raw_input(colored("[-] Enter tables name ", 'blue'))
            if tab in c.tables():
                print(colored("[-] Enumerating Columns", 'blue'))
                t = c.table(tab)
                for i in t.columns():
                    print(colored("\t[-] "+str(i), 'green'))
            else:
                print(colored("[-] No such table Exists ", 'red'))
    except Exception as e:
        print(colored("[-] Error Occured while connection %s " %
                      (str(e)), 'red'))
